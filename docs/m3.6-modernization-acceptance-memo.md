# M3.6 Migration Auth Modernization Acceptance Memo

Date: 2026-02-22
Milestone: M3.6 (mandatory pre-M4 closeout)
Scope type: maintainability and safety hardening only (no feature expansion)

## Decision

M3.6 modernization is accepted as complete for roadmap progression to M4.

## Implemented Scope

- Alembic is authoritative for schema evolution.
- Deterministic baseline revision history is established.
- Startup migration policy avoids implicit production auto-migration.
- Bespoke auth primitives were replaced with proven maintained libraries:
  - `passlib` for password hashing.
  - `PyJWT` for JWT encode/decode.
- Locked auth/state constraints are preserved:
  - email/password plus JWT only.
  - wallet login remains forbidden.
  - API/state-machine semantics unchanged.

## Evidence

Implementation artifacts:

- `backend/alembic.ini`
- `backend/alembic/env.py`
- `backend/alembic/script.py.mako`
- `backend/alembic/versions/202602220000_baseline_schema.py`
- `backend/app/db/init_db.py`
- `backend/app/core/security.py`
- `pyproject.toml`

Verification artifacts:

- `backend/tests/migration/test_alembic_baseline_contract.py`
- `backend/tests/unit/test_db_init.py`
- `backend/tests/unit/test_security.py`
- `backend/tests/unit/test_api_dependencies_auth.py`
- `backend/tests/contract/test_auth_api_contract.py`
- `backend/tests/security/test_auth_mode_contract.py`

Command results (executed 2026-02-22):

- `python -m compileall backend/app backend/tests`: pass
- `python -m ruff format --check backend`: pass
- `python -m ruff check backend`: pass
- `python -m pytest backend/tests -q`: pass (`56 passed`)
- `python -m alembic -c backend/alembic.ini history`: pass (`<base> -> 202602220000_baseline_schema (head)`)

## Gate Summary

- Scope integrity: pass
- Domain correctness: pass
- Security and invariants: pass
- Full-spectrum testing for impacted surfaces: pass
- Documentation and traceability updates: pass
- Operational readiness for this slice: pass

## Residual Risks

- Production deployments must provide a strong JWT secret via environment configuration.
- Local environment may emit a pytest cache permission warning; it does not affect test correctness.

## Next Step

Proceed to M4 hardening closeout:

- Xaman integration and non-custodial signing completion (`R-06`)
- failure taxonomy and resilience expansion (`R-12`)
- e2e/frontend critical-journey coverage (`R-01`, `R-10`)
- performance/regression and operations runbook hardening
