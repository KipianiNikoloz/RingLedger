# FightPurse MVP Requirements Matrix

Date locked: 2026-02-16

## MVP Scope Lock

This project is locked to the following constraints for MVP:

- Stack: FastAPI (Python), PostgreSQL, React, XRPL Testnet, Xaman signing.
- Auth model: email/password + JWT only (no wallet login).
- Money model: XRP only; all amounts represented as drops (integers); DB storage as BIGINT.
- Bout model: strict 1v1 with exactly four escrows: `show_a`, `show_b`, `bonus_a`, `bonus_b`.
- Custody split: platform controls bonus fulfillment/preimage, promoter controls signatures.
- Signing boundary: backend never stores promoter private keys.
- Timing rules: `FinishAfter = event_datetime_utc + 2h`; `CancelAfter = event_datetime_utc + 7d` for bonus escrows only.
- Ledger truth: lifecycle state transitions only after validated XRPL `tesSUCCESS`.
- Idempotency: required on confirm endpoints.
- Trust model: frontend untrusted; backend enforces all invariants.

## Requirement Baseline (R-01..R-12)

| ID | Requirement | Acceptance Criteria |
|---|---|---|
| R-01 | Stack fixed to FastAPI + PostgreSQL + React + XRPL Testnet + Xaman | Backend service runs on FastAPI; data persists in PostgreSQL; frontend implemented in React; XRPL calls target Testnet endpoints; promoter signing flow uses Xaman deep link/QR. |
| R-02 | Auth is email/password + JWT only | `POST /auth/register` and `POST /auth/login` issue JWT; protected endpoints require JWT; no wallet-address-based login endpoint exists. |
| R-03 | Money is XRP drops integer only | All API amount fields are integer drops; persistence uses BIGINT; no float/decimal math path exists; conversion invariant `1 XRP = 1,000,000 drops` is test-covered. |
| R-04 | Bout model is 1v1 with four escrows | Bout creation creates exactly four escrow rows: `show_a`, `show_b`, `bonus_a`, `bonus_b`; no additional escrow kinds accepted in MVP. |
| R-05 | Bonus control split is mandatory | `bonus_*` EscrowCreate includes condition generated by platform; only platform-owned secret can produce fulfillment; promoter cannot finish bonus without fulfillment. |
| R-06 | Backend is non-custodial for promoter keys | Backend never stores promoter private keys; all sign/submit actions are initiated in Xaman; backend only receives tx hash/confirmation artifacts. |
| R-07 | Time rules are fixed | `FinishAfter` computed from event UTC + 2h for all escrows; `CancelAfter` computed from event UTC + 7d for bonus escrows only; guards enforce these times before payout/cancel actions. |
| R-08 | State transitions depend on validated ledger success | No transition to `created`, `finished`, or `cancelled` occurs until transaction is validated on-ledger with `tesSUCCESS` and field invariants match expected values. |
| R-09 | Confirm endpoints are idempotent | Confirm endpoints require `Idempotency-Key`; replay with same request returns stored result; replay with mismatched request body is rejected deterministically. |
| R-10 | Frontend is untrusted | Backend validates role, object ownership, source state, timing, amount, and tx invariants on every critical action; client-side checks are treated as UX only. |
| R-11 | Lifecycle state machines are explicit | Bout and escrow states/transitions are documented and enforced in code; illegal transitions are rejected with consistent error classes. |
| R-12 | Failure handling is explicit | Declined signing, `tec/tem`, timeout, and invalid confirmation are persisted/audited, surfaced to caller, and do not advance state incorrectly. |

## Role Journeys (MVP)

| Actor | Journey | Done When |
|---|---|---|
| Fighter | Register, login, update profile with XRPL address | Valid profile persisted; address format validated; fighter can view own profile and scoped bout info. |
| Promoter | Create bout draft with purse values and event time | Bout row exists with valid purse drops and four planned escrows. |
| Promoter | Prepare escrow transactions and sign via Xaman | Prepare endpoint returns unsigned payloads; promoter signs in Xaman; confirm endpoint validates and persists `offer_sequence` + tx hash. |
| Admin | Enter bout winner A/B | Winner is stored once; state transitions to `result_entered`; winner mutability locked when payouts start. |
| Promoter | Prepare and confirm payouts | Show escrows finish after `FinishAfter`; winner bonus finishes with fulfillment; state transitions only after validated ledger confirmation. |
| System | Close bout lifecycle | Bout reaches `closed` only when required payout completion conditions are met and validated. |

## Non-Goals (Explicitly Out of MVP)

- Wallet-based login.
- Athletic commission/oracle-based auto-result feeds.
- Multiple bonus categories beyond one winner bonus pair.
- Management revenue split escrows.
- Stablecoin/issued-token support.
- Multisig/signer-list authorization alternative.
- Dispute-resolution workflow gating fulfillment release.

## Change Control

- Any change to R-01..R-12 requires:
  - explicit diff in this file,
  - related ADR update,
  - updated traceability rows,
  - matching test plan updates before implementation.
